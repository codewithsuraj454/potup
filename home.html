<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Potup</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>@import url('https://fonts.googleapis.com/css2?family=Edu+NSW+ACT+Cursive:wght@400..700&display=swap');</style>
<link rel="icon" type="image/png" href="ChatGPT_Image_Dec_12__2025__03_11_52_PM__1_-removebg-preview.png">

<style>
* { 
  box-sizing: border-box; 
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  margin: 0;
  padding: 0;
  -webkit-tap-highlight-color: transparent;
}

:root {
  --bg-primary: #000000;
  --bg-secondary: #16181c;
  --bg-hover: #1d1f23;
  --border-color: #2f3336;
  --text-primary: #e7e9ea;
  --text-secondary: #71767b;
  --accent: #1d9bf0;
  --accent-hover: #1a8cd8;
  --verified: #1d9bf0;
  --elite: #ff8c00;
  --founder: #ef4444;
  --ad: #fbbf24;
  --active: #10b981;
}

body { 
  background: var(--bg-primary);
  color: var(--text-primary);
  display: flex;
  min-height: 100vh;
  transition: all 0.3s ease;
  overflow-x: hidden;
  background-color: #0b0e14;
  background-image: 
    radial-gradient(at 0% 0%, rgba(76, 0, 255, 0.15) 0px, transparent 50%),
    radial-gradient(at 100% 0%, rgba(0, 210, 255, 0.15) 0px, transparent 50%),
    radial-gradient(at 100% 100%, rgba(255, 0, 153, 0.1) 0px, transparent 50%),
    radial-gradient(at 0% 100%, rgba(0, 255, 170, 0.1) 0px, transparent 50%),
    radial-gradient(at 50% 50%, rgba(15, 12, 41, 1) 0px, transparent 100%);
}

nav {
  width: 275px;
  padding: 20px 10px;
  height: 78vh;
  position: sticky;
  top: 12px;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  margin-left: 10px;
  margin-top: 12px;
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(20px) saturate(160%);
  -webkit-backdrop-filter: blur(20px) saturate(160%);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
}

nav h1 {
  margin-bottom: 17px;
  margin-left: 30px;
  margin-right: 10px;
  font-size: 35px;
  font-weight: 800;
  letter-spacing: -1px;
  font-family: 'Inter', system-ui, sans-serif;
  background-image: linear-gradient(to right, #d0eaff, #8a2be2);
  background-clip: text;
  -webkit-background-clip: text;
  color: transparent;
  -webkit-text-fill-color: transparent;
  text-shadow: 0 0 15px rgba(0, 210, 255, 0.3);
}

nav::-webkit-scrollbar {
  width: 4px;
}

nav::-webkit-scrollbar-track {
  background: transparent;
}

nav::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 10px;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 20px;
  padding: 12px 20px;
  margin: 5px 0;
  cursor: pointer;
  border-radius: 10px;
  font-size: 20px;
  font-weight: 500;
  transition: all 0.2s;
  position: relative;
  color: white;
}

.nav-item:hover {
  border-color:#1d9bf0;
  box-shadow: inset 0 0 10px rgba(29, 155, 240, 0.6);
}

.nav-item.active {
  font-weight: 700;
}

.nav-item .material-icons {
  font-size: 26px;
  color: white;
}

.notification-badge {
  position: absolute;
  top: 8px;
  left: 35px;
  background: var(--founder);
  color: white;
  font-size: 11px;
  font-weight: 700;
  min-width: 18px;
  height: 18px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 4px;
}

.timer-widget {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(15px) saturate(120%);
  -webkit-backdrop-filter: blur(15px) saturate(120%);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 16px;
  margin: 10px 0;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  color: white;
  text-align: center;
}

.timer-widget h4 {
  font-size: 13px;
  font-weight: 600;
  margin-bottom: 8px;
  color: rgba(255, 255, 255, 0.7);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.timer-display {
  font-size: 24px;
  font-weight: 800;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.mobile-nav {
  display: none;
  position: fixed;
  bottom: 15px;
  left: 10px;
  right: 10px;
  padding: 10px 0;
  z-index: 1000;
  background: rgba(255, 255, 255, 0.1); 
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 24px;
  color: rgba(255, 255, 255, 0.7);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
}

.mobile-nav-items {
  display: flex;
  justify-content: space-around;
  align-items: center;
}

.mobile-nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: 8px 12px;
  cursor: pointer;
  border-radius: 16px;
  transition: all 0.3s ease;
  position: relative;
}

.mobile-nav-item:active {
  background: rgba(255, 255, 255, 0.1);
  transform: scale(0.95);
}

.mobile-nav-item.active {
  color: #ffffff;
  text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
}

.mobile-nav-item.active .material-icons {
  color: var(--accent);
}

.mobile-nav-item .material-icons {
  font-size: 26px;
  transition: transform 0.2s ease;
}

.mobile-notification-badge {
  position: absolute;
  top: 2px;
  right: 8px;
  background: #ff4b2b;
  color: white;
  font-size: 10px;
  font-weight: 800;
  min-width: 18px;
  height: 18px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 4px;
  border: 2px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 0 10px rgba(255, 75, 43, 0.5);
}

main { 
  flex: 1;
  display: flex;
  max-width: 1280px;
  margin: 0 auto;
  width: 100%;
  padding: 10px;
}

.page {
  display: none !important;
}

.page.active {
  display: flex !important;
  flex: 1;
}

.feed-container {
  flex: 1;
  border-right: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
  gap: 10px;
}

.page-header {
  padding: 16px 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(15px) saturate(150%);
  -webkit-backdrop-filter: blur(15px) saturate(150%);
  background: rgba(255, 255, 255, 0.03); 
  z-index: 100;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
}

.page-header h2 {
  font-size: 20px;
  font-weight: 800;
  color: #ffffff;
  margin: 0;
  letter-spacing: -0.5px;
}

.header-actions {
  display: flex;
  gap: 8px;
}

.icon-btn-header {
  background: transparent;
  border: 1px solid var(--border-color);
  color: var(--text-primary);
  cursor: pointer;
  padding: 8px 12px;
  border-radius: 20px;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: all 0.2s;
  font-size: 14px;
  font-weight: 600;
}

.icon-btn-header:hover {
  background: var(--bg-hover);
}

.feed-scroll-area {
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
  background-color: transparent;
  color: whitesmoke;
}

.feed-scroll-area::-webkit-scrollbar {
  display: none;
}

#feed { 
  min-height: 100%;
  padding-bottom: 80px;
}

#greeting {
  font-size: 34px;
  font-weight: 700;
  color: var(--text-primary);
  margin: 20px 0 10px 0;
}

#feedSubtext {
  font-size: 18px;
  font-weight: 500;
  color: var(--text-secondary);
  margin: 0 0 20px 0;
}

.post-composer {
  padding: 20px;
  background: var(--glass-bg);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid var(--glass-border);
  border-radius: 24px;
  box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
  margin-bottom: 20px;
}

.composer-wrapper {
  display: flex;
  gap: 12px;
}

.composer-wrapper img {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  object-fit: cover;
  flex-shrink: 0;
  border: 1.5px solid var(--glass-border);
}

.composer-content {
  flex: 1;
  position: relative;
}

.composer-content textarea {
  width: 100%;
  padding: 12px 0;
  border: none;
  background: transparent;
  color: var(--text-primary);
  font-size: 18px;
  resize: none;
  outline: none;
  font-family: 'Inter', sans-serif;
  min-height: 80px;
}

.composer-content textarea::placeholder {
  color: var(--text-secondary);
}

.char-counter {
  font-size: 12px;
  color: var(--text-secondary);
  margin-top: 8px;
}

.char-counter.warning {
  color: #fbbf24;
}

.char-counter.error {
  color: #ef4444;
}

.category-selector {
  margin: 16px 0;
  padding: 16px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 16px;
  border: 1px solid var(--glass-border);
}

.category-selector label {
  display: block;
  font-size: 13px;
  color: var(--text-secondary);
  margin-bottom: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.category-options {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.category-option {
  padding: 8px 16px;
  border: 1px solid var(--glass-border);
  border-radius: 20px;
  background: rgba(255, 255, 255, 0.05);
  color: var(--text-primary);
  font-size: 13px;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-weight: 500;
}

.category-option:hover {
  background: var(--glass-hover);
  border-color: rgba(255, 255, 255, 0.4);
  transform: translateY(-1px);
}

.category-option.selected {
  background: var(--text-primary);
  border-color: var(--text-primary);
  color: black;
  box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3);
}

.composer-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 12px;
  padding-top: 16px;
  border-top: 1px solid var(--glass-border);
}

.composer-icons {
  display: flex;
  gap: 12px;
}

.icon-btn {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid transparent;
  color: var(--text-primary);
  cursor: pointer;
  padding: 10px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  transition: all 0.2s;
}

.icon-btn:hover {
  background: var(--glass-hover);
  border-color: var(--glass-border);
  color: var(--accent);
}

.post-btn {
  background: var(--accent);
  color: white;
  border: none;
  padding: 10px 24px;
  border-radius: 25px;
  font-weight: 700;
  cursor: pointer;
  box-shadow: 0 4px 15px rgba(0, 210, 255, 0.3);
  transition: all 0.2s;
  font-size: 15px;
}

.post-btn:hover {
  transform: scale(1.05);
  filter: brightness(1.1);
}

.post-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.post {
  padding: 14px 18px;
  border-bottom: 1px solid var(--border-color);
  transition: background 0.2s;
  cursor: pointer;
  border-radius: 11px;
  margin-bottom: 20px;
  margin-left: 10px;
  margin-right: 10px;
  background: rgba(255, 255, 255, 0.08); 
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
  color: #ffffff;
}

.post:active {
  background: var(--bg-hover);
}

.post-content-wrapper {
  display: flex;
  gap: 12px;
}

.post-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
  flex-shrink: 0;
}

.post-main {
  flex: 1;
  min-width: 0;
}

.post-header {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
  flex-wrap: wrap;
}

.username {
  font-weight: 700;
  font-size: 15px;
  cursor: pointer;
}

.username:active {
  text-decoration: underline;
}

.post-time {
  color: var(--text-secondary);
  font-size: 15px;
}

.post-category {
  font-size: 12px;
  padding: 2px 8px;
  border-radius: 10px;
  background: var(--bg-secondary);
  color: var(--accent);
  margin-left: auto;
  font-weight: 600;
}

.post-text {
  font-size: 15px;
  line-height: 20px;
  margin: 4px 0 12px 0;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.post-img {
  max-width: 100%;
  border-radius: 16px;
  margin-top: 12px;
  border: 1px solid var(--border-color);
  display: block;
}

.repost-indicator {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: var(--text-secondary);
  margin-bottom: 8px;
}

.repost-indicator .material-icons {
  font-size: 16px;
  color: #10b981;
}

.badge {
  display: inline-flex;
  align-items: center;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 700;
  margin-left: 4px;
}

.badge.verified {
  background: rgba(29, 155, 240, 0.2);
  color: var(--verified);
}

.badge.elite {
  background: rgba(255, 140, 0, 0.2);
  color: var(--elite);
}

.badge.founder {
  background: rgba(239, 68, 68, 0.2);
  color: var(--founder);
}

.badge.ad {
  background: rgba(251, 191, 36, 0.2);
  color: var(--ad);
}

.badge.active {
  background: rgba(16, 185, 129, 0.2);
  color: var(--active);
}

.post-actions {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-top: 12px;
  padding-top: 8px;
}

.action-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 6px 10px;
  border-radius: 20px;
  font-size: 14px;
  transition: all 0.2s;
  font-weight: 500;
}

.action-btn:hover {
  background: rgba(239, 68, 68, 0.1);
}

.action-btn.liked {
  color: var(--founder);
}

.action-btn.reposted {
  color: #10b981;
}

.action-btn.reply-btn:hover {
  background: rgba(29, 155, 240, 0.1);
}

.action-btn.reply-btn:hover .material-icons {
  color: var(--accent);
}

.action-btn.repost-btn:hover {
  background: rgba(16, 185, 129, 0.1);
}

.action-btn.repost-btn:hover .material-icons {
  color: #10b981;
}

.action-btn .material-icons {
  font-size: 18px;
  transition: all 0.2s;
}

.action-btn:hover .material-icons {
  color: var(--founder);
}

.action-btn.liked .material-icons {
  color: var(--founder);
}

.action-btn.reposted .material-icons {
  color: #10b981;
}

.like-count, .reply-count, .repost-count {
  font-size: 14px;
  min-width: 20px;
  text-align: left;
}

#searchBar {
  width: 350px;
  padding: 20px;
  height: 100vh;
  position: sticky;
  top: 0;
  overflow-y: auto;
}

.search-widget, .newssection {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(15px) saturate(120%);
  -webkit-backdrop-filter: blur(15px) saturate(120%);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  color: white;
  margin-right: 5px;
}

.search-widget h3, .newssection h3 {
  font-size: 20px;
  font-weight: 800;
  margin-bottom: 16px;
  letter-spacing: -0.5px;
  background: linear-gradient(to right, #fff, rgba(255,255,255,0.5));
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.search-container {
  display: flex;
  gap: 10px;
  margin-bottom: 16px;
}

.search-input {
  flex: 1;
  padding: 12px 16px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 25px;
  background: rgba(255, 255, 255, 0.05);
  color: white;
  font-size: 14px;
  outline: none;
  transition: all 0.2s;
}

.search-input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 2px rgba(29, 155, 240, 0.2);
}

.search-results {
  overflow: visible;
}

.search-result-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  cursor: pointer;
  border-radius: 12px;
  transition: all 0.2s;
  margin-bottom: 8px;
}

.search-result-item:hover {
  background: rgba(255, 255, 255, 0.05);
}

.search-result-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
}

.search-result-info h4 {
  font-size: 14px;
  font-weight: 600;
  margin: 0;
  color: white;
}

.search-result-info p {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.6);
  margin: 2px 0 0 0;
}

#searchBar::-webkit-scrollbar {
  width: 0px;
}

.news-item {
  margin-bottom: 12px;
  font-size: 14px;
  line-height: 1.4;
  color: white;
  cursor: pointer;
  transition: all 0.2s;
  padding: 12px;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.news-item:hover {
  background: rgba(255, 255, 255, 0.08);
  transform: translateY(-2px);
}

.news-item strong {
  display: block;
  margin-bottom: 4px;
  font-weight: 700;
}

.mobile-search-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(10px);
  z-index: 2000;
  padding: 20px;
}

.mobile-search-content {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(25px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 24px;
  padding: 20px;
  max-width: 500px;
  margin: 0 auto;
  margin-top: 60px;
  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
}

.mobile-search-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.mobile-search-header h3 {
  font-size: 20px;
  font-weight: 800;
  color: white;
}

.close-search {
  background: transparent;
  border: none;
  color: white;
  font-size: 24px;
  cursor: pointer;
  padding: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.reply-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(10px);
  z-index: 2000;
  padding: 20px;
  align-items: center;
  justify-content: center;
}

.reply-modal-content {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(25px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 24px;
  padding: 24px;
  max-width: 600px;
  width: 100%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
}

.reply-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.reply-modal-header h3 {
  font-size: 20px;
  font-weight: 800;
  color: white;
}

.close-reply {
  background: transparent;
  border: none;
  color: white;
  font-size: 24px;
  cursor: pointer;
}

.reply-to {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 16px;
}

.reply-composer {
  margin-bottom: 20px;
}

.reply-composer textarea {
  width: 100%;
  padding: 12px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.05);
  color: white;
  font-size: 15px;
  resize: none;
  outline: none;
  font-family: 'Inter', sans-serif;
  min-height: 100px;
}

.reply-composer textarea::placeholder {
  color: rgba(255, 255, 255, 0.5);
}

.replies-list {
  margin-top: 24px;
  padding-top: 20px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.replies-list h4 {
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 16px;
  color: white;
}

.reply-item {
  display: flex;
  gap: 12px;
  padding: 12px;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 12px;
  margin-bottom: 12px;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.reply-avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  object-fit: cover;
  flex-shrink: 0;
}

.reply-content-wrapper {
  flex: 1;
}

.reply-header {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}

.reply-text {
  font-size: 14px;
  line-height: 1.4;
  color: rgba(255, 255, 255, 0.9);
}

.hidden {
  display: none !important;
}

input[type="file"] {
  display: none;
}

#emojiPicker {
  position: absolute;
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: 16px;
  width: 320px;
  max-width: 90vw;
  max-height: 400px;
  overflow-y: auto;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
  z-index: 1000;
  margin-top: 8px;
  display: none;
}

#emojiGrid {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  gap: 4px;
  padding: 12px;
}

.emoji-btn-item {
  background: transparent;
  border: none;
  font-size: 24px;
  padding: 8px;
  cursor: pointer;
  border-radius: 8px;
  transition: all 0.2s;
}

.emoji-btn-item:active {
  background: var(--bg-hover);
  transform: scale(1.2);
}

#emojiPicker::-webkit-scrollbar {
  width: 8px;
}

#emojiPicker::-webkit-scrollbar-track {
  background: var(--bg-secondary);
}

#emojiPicker::-webkit-scrollbar-thumb {
  background: var(--border-color);
  border-radius: 4px;
}

.loading-spinner {
  display: flex;
  justify-content: center;
  padding: 20px;
}

.spinner {
  width: 30px;
  height: 30px;
  border: 3px solid var(--border-color);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

@keyframes slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

@keyframes slideOut {
  from { transform: translateX(0); opacity: 1; }
  to { transform: translateX(100%); opacity: 0; }
}

#profilePage,
#viewProfilePage {
  flex: 1;
  max-width: 1000px;
  overflow-y: auto;
  height: 100vh;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}

#profilePage::-webkit-scrollbar {
  display: none;
}

.profile-banner {
  height: 220px;
  background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%);
  position: relative;
  overflow: hidden;
}

.profile-banner::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(to bottom, transparent, rgba(0,0,0,0.3));
}

.profile-info {
  padding: 0 25px;
  position: relative;
  background: rgba(255, 255, 255, 0.02);
  backdrop-filter: blur(10px);
}

.profile-avatar {
  width: 134px;
  height: 134px;
  border-radius: 50%;
  border: 4px solid rgba(255, 255, 255, 0.2);
  margin-top: -67px;
  object-fit: cover;
  cursor: pointer;
  background: #222;
  box-shadow: 0 8px 32px rgba(0,0,0,0.5);
  transition: transform 0.3s ease;
}

.profile-avatar:hover {
  transform: scale(1.05);
}

.edit-profile-btn {
  position: absolute;
  right: 25px;
  top: 15px;
  padding: 10px 22px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 30px;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(5px);
  color: white;
  font-weight: 700;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.edit-profile-btn:hover {
  background: white;
  color: black;
}

.profile-details {
  margin-top: 15px;
  color: white;
}

.profile-name {
  font-size: 24px;
  font-weight: 800;
  display: flex;
  align-items: center;
  gap: 8px;
  letter-spacing: -0.5px;
}

.profile-username {
  font-size: 16px;
  color: rgba(255, 255, 255, 0.6);
  margin-top: 2px;
}

.profile-bio {
  margin: 16px 0;
  font-size: 15px;
  line-height: 1.5;
  color: rgba(255, 255, 255, 0.9);
  max-width: 600px;
}

.profile-stats {
  display: flex;
  gap: 25px;
  margin: 15px 0;
  padding: 16px 0;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.stat-value {
  font-weight: 800;
  font-size: 16px;
  color: white;
}

.stat-label {
  color: rgba(255, 255, 255, 0.6);
  font-size: 15px;
  margin-left: 4px;
}

.interests-section {
  margin: 20px 0;
  padding: 20px;
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 20px;
}

.interests-section h3 {
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 15px;
  color: white;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.interests-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.interest-chip {
  padding: 8px 18px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 25px;
  background: rgba(255, 255, 255, 0.05);
  color: white;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.interest-chip:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: var(--accent);
}

.interest-chip.selected {
  background: var(--accent);
  border-color: var(--accent);
  color: white;
  box-shadow: 0 0 15px rgba(0, 210, 255, 0.4);
}

.interests-info {
  margin-top: 12px;
  font-size: 12px;
  color: rgba(255, 255, 255, 0.5);
}

.profile-posts-section {
  margin-top: 20px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.profile-posts-header {
  padding: 16px 20px;
  font-size: 18px;
  font-weight: 700;
  color: white;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  position: sticky;
  top: 0;
  background: rgba(255, 255, 255, 0.02);
  backdrop-filter: blur(15px);
  z-index: 5;
}

#notificationsPage {
  flex: 1;
  max-width: 1000px;
  overflow-y: auto;
  height: 100vh;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none; 
}

#notificationsPage::-webkit-scrollbar {
  display: none;
}

#notificationsList {
  padding: 10px;
  padding-bottom: 80px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.notification-item {
  padding: 16px 20px;
  background: rgba(255, 255, 255, 0.03);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.05);
  border-radius: 16px;
  display: flex;
  align-items: center;
  gap: 15px;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  color: white;
}

.notification-item:hover {
  background: rgba(255, 255, 255, 0.08);
  border-color: rgba(255, 255, 255, 0.2);
  transform: translateY(-2px);
}

.notification-item.unread {
  background: rgba(29, 155, 240, 0.1);
  border-left: 4px solid var(--accent);
  box-shadow: 0 4px 15px rgba(29, 155, 240, 0.1);
}

.notification-icon {
  width: 44px;
  height: 44px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  flex-shrink: 0;
  transition: transform 0.2s;
}

.notification-item:hover .notification-icon {
  transform: rotate(-5deg) scale(1.1);
}

.notification-icon.follow {
  background: rgba(29, 155, 240, 0.15);
  color: var(--accent);
  border-color: rgba(29, 155, 240, 0.3);
}

.notification-icon.like {
  background: rgba(239, 68, 68, 0.15);
  color: var(--founder);
  border-color: rgba(239, 68, 68, 0.3);
}

.notification-icon.system {
  background: rgba(139, 92, 246, 0.15);
  color: #a78bfa;
  border-color: rgba(139, 92, 246, 0.3);
}

.notification-content {
  flex: 1;
  min-width: 0;
}

.notification-text {
  font-size: 15px;
  line-height: 1.4;
  color: rgba(255, 255, 255, 0.9);
}

.notification-text strong {
  font-weight: 700;
  color: #fff;
}

.notification-time {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.5);
  margin-top: 4px;
  font-weight: 500;
}

.no-notifications {
  text-align: center;
  padding: 100px 20px;
  color: rgba(255, 255, 255, 0.6);
  background: rgba(255, 255, 255, 0.02);
  border-radius: 24px;
  margin: 20px;
  border: 1px dashed rgba(255, 255, 255, 0.1);
}

#settingsPage {
  position: relative;
  z-index: 1;
  display: flex;
  flex-direction: column;
  max-width: 800px;
  margin: 0 auto;
  min-height: 100vh;
  padding-bottom: 60px;
  overflow-y: auto;
  scrollbar-width: none;
  -webkit-overflow-scrolling: touch;
}

#settingsPage::-webkit-scrollbar {
  display: none;
}

.glass-header {
  position: sticky;
  top: 0;
  z-index: 1000;
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.15);
  padding: 24px 20px;
  width: 100%;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
}

.glass-header h2 {
  margin: 0;
  font-size: 24px;
  font-weight: 800;
  color: #fff;
  text-align: center;
  letter-spacing: -0.5px;
}

.settings-section {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  margin: 16px;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
  transition: transform 0.3s ease;
}

.settings-section:hover {
  transform: translateY(-2px);
}

.section-title {
  padding: 16px 20px 12px;
  font-size: 13px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: rgba(255, 255, 255, 0.6);
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}

.settings-item {
  width: 100%;
  padding: 18px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);
  cursor: pointer;
  transition: all 0.2s ease;
  text-decoration: none;
  color: inherit;
}

.settings-item:last-child {
  border-bottom: none;
}

.settings-item:hover:not(.no-hover) {
  background: rgba(255, 255, 255, 0.08);
}

.settings-item:active:not(.no-hover) {
  transform: scale(0.98);
}

.settings-item-left {
  display: flex;
  align-items: center;
  gap: 15px;
  flex: 1;
}

.settings-item-left .material-icons {
  color: var(--accent);
  font-size: 24px;
  filter: drop-shadow(0 0 8px var(--accent-glow));
}

.item-text {
  display: flex;
  flex-direction: column;
}

.item-text h4 {
  margin: 0 0 4px 0;
  font-size: 16px;
  font-weight: 600;
  color: #ffffff;
}

.item-text p {
  margin: 0;
  font-size: 13px;
  color: rgba(255, 255, 255, 0.5);
}

.chevron {
  color: rgba(255, 255, 255, 0.3);
  font-size: 20px;
}

.toggle-switch {
  position: relative;
  width: 50px;
  height: 28px;
  flex-shrink: 0;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
  position: absolute;
}

.toggle-slider {
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.15);
  border-radius: 30px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  cursor: pointer;
  transition: all 0.3s ease;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 3px;
  bottom: 3px;
  background: white;
  border-radius: 50%;
  transition: all 0.3s ease;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

input:checked + .toggle-slider {
  background: var(--accent);
  box-shadow: 0 0 16px var(--accent-glow);
}

input:checked + .toggle-slider:before {
  transform: translateX(22px);
}

.badge-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
  padding: 16px;
}

.badge-card {
  background: rgba(255, 255, 255, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.12);
  border-radius: 16px;
  padding: 20px;
  text-align: center;
  transition: all 0.3s ease;
}

.badge-card:hover {
  background: rgba(255, 255, 255, 0.1);
  transform: translateY(-4px);
}

.badge-card .material-icons {
  font-size: 40px;
  margin-bottom: 12px;
  filter: drop-shadow(0 0 12px currentColor);
}

.active-icon { color: #4ade80; }
.elite-icon { color: #fbbf24; }
.active-user-icon { color: #00d9ff; }

.badge-card h4 {
  font-size: 16px;
  font-weight: 700;
  margin: 0 0 6px 0;
  color: #fff;
}

.badge-card p {
  font-size: 13px;
  color: rgba(255, 255, 255, 0.5);
  margin: 0;
}

.status-indicator {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  flex-shrink: 0;
}

.status-indicator.online {
  background: #4ade80;
  box-shadow: 0 0 12px #4ade80;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

.text-btn {
  background: rgba(255, 59, 48, 0.15);
  border: 1px solid rgba(255, 59, 48, 0.3);
  color: #ff3b30;
  padding: 8px 16px;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}

.text-btn:hover {
  background: rgba(255, 59, 48, 0.25);
  transform: scale(1.05);
}

.text-btn:active {
  transform: scale(0.95);
}

.support-card {
  background: rgba(255, 255, 255, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.12);
  border-radius: 16px;
  padding: 20px;
  margin: 16px;
}

.support-info {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 16px;
}

.support-info .material-icons {
  color: var(--accent);
  font-size: 32px;
  filter: drop-shadow(0 0 8px var(--accent-glow));
}

.support-info h4 {
  font-size: 16px;
  font-weight: 700;
  margin: 0 0 4px 0;
  color: #fff;
}

.support-info p {
  font-size: 13px;
  color: rgba(255, 255, 255, 0.6);
  margin: 0;
}

.support-info strong {
  color: var(--accent);
  font-weight: 600;
}

.contact-btn {
  width: 100%;
  background: var(--accent);
  color: #000;
  border: none;
  padding: 14px;
  border-radius: 12px;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 4px 16px var(--accent-glow);
}

.contact-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 24px var(--accent-glow);
}

.contact-btn:active {
  transform: translateY(0);
}

.logout-full-btn {
  width: calc(100% - 32px);
  margin: 16px;
  background: rgba(255, 59, 48, 0.15);
  border: 1px solid rgba(255, 59, 48, 0.3);
  color: #ff3b30;
  padding: 16px;
  border-radius: 16px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  transition: all 0.2s ease;
}

.logout-full-btn:hover {
  background: rgba(255, 59, 48, 0.25);
  transform: translateY(-2px);
}

.logout-full-btn:active {
  transform: translateY(0);
}

.logout-full-btn .material-icons {
  font-size: 20px;
}

.toast {
  position: fixed;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: rgba(0, 0, 0, 0.9);
  backdrop-filter: blur(20px);
  color: white;
  padding: 16px 24px;
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  font-size: 14px;
  font-weight: 500;
  z-index: 2000;
  opacity: 0;
  transition: all 0.3s ease;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
}

.toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

#profileModal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  justify-content: center;
  align-items: center;
  z-index: 2000;
  padding: 20px;
}

.modal-box {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(25px) saturate(150%);
  -webkit-backdrop-filter: blur(25px) saturate(150%);
  border: 1px solid rgba(255, 255, 255, 0.2);
  padding: 32px;
  max-width: 400px;
  width: 100%;
  border-radius: 24px;
  position: relative;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
  color: white;
}

.close {
  position: absolute;
  top: 20px;
  right: 20px;
  cursor: pointer;
  font-size: 24px;
  color: rgba(255, 255, 255, 0.6);
  transition: all 0.2s;
}

.close:hover {
  color: white;
  transform: rotate(90deg);
}

.modal-avatar {
  width: 110px;
  height: 110px;
  border-radius: 50%;
  margin: 0 auto 16px;
  display: block;
  object-fit: cover;
  border: 3px solid rgba(255, 255, 255, 0.2);
  box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
}

.modal-content {
  text-align: center;
}

.modal-username {
  font-size: 24px;
  font-weight: 800;
  margin-bottom: 8px;
  letter-spacing: -0.5px;
}

.modal-badges {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 8px;
  margin: 12px 0;
}

.modal-badges span {
  background: rgba(255, 255, 255, 0.1);
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.modal-bio {
  color: rgba(255, 255, 255, 0.8);
  margin: 16px 0;
  line-height: 1.5;
  font-size: 15px;
}

.modal-actions {
  display: flex;
  gap: 12px;
  margin-top: 24px;
}

.modal-follow-btn {
  flex: 1;
  padding: 12px;
  border: none;
  border-radius: 30px;
  font-weight: 700;
  font-size: 15px;
  cursor: pointer;
  background: white;
  color: #1a1a1a;
  box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
}

.modal-follow-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(255, 255, 255, 0.3);
}

.modal-share-btn {
  flex: 1;
  padding: 12px;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 30px;
  color: white;
  font-weight: 700;
  font-size: 15px;
  cursor: pointer;
  transition: all 0.2s;
}

.modal-share-btn:hover {
  background: rgba(255, 255, 255, 0.15);
}

.modal-box::-webkit-scrollbar {
  width: 5px;
}

.modal-box::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 10px;
}

@media (max-width: 768px) {
  #searchBar {
    display: none;
  }

  nav {
    display: none;
  }
  
  .mobile-nav {
    display: block;
  }
  
  main {
    padding-bottom: 0;
  }
  
  .feed-container {
    border-right: none;
  }
  
  #feed,
  .profile-posts-section,
  #notificationsList {
    padding-bottom: 70px;
  }
  
  .page-header {
    padding: 12px 16px;
  }
  
  .page-header h2 {
    font-size: 18px;
  }
  
  .icon-btn-header {
    padding: 6px 10px;
    font-size: 13px;
  }
  
  .icon-btn-header .material-icons {
    font-size: 18px;
  }
  
  .post-composer {
    padding: 12px 16px;
  }
  
  .composer-wrapper img {
    width: 40px;
    height: 40px;
  }
  
  .composer-content textarea {
    font-size: 16px;
  }
  
  .category-selector {
    padding: 10px;
  }
  
  .post {
    padding: 12px 16px;
  }
  
  .profile-banner {
    height: 150px;
  }
  
  .profile-avatar {
    width: 100px;
    height: 100px;
    margin-top: -50px;
  }
  
  .profile-info {
    padding: 0 16px;
  }

  .modal-box {
    padding: 24px;
    margin: 20px;
  }
  
  #emojiGrid {
    grid-template-columns: repeat(6, 1fr);
  }

  .badge-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
  }

  .settings-section {
    margin: 20px;
  }

  #settingsPage {
    padding-bottom: 120px;
    margin: 0 10px;
  }
}

@media (max-width: 480px) {
  .composer-content textarea {
    font-size: 15px;
  }
  
  .post-text {
    font-size: 14px;
  }
  
  .username {
    font-size: 14px;
  }
  
  .post-time {
    font-size: 13px;
  }
  
  .category-option {
    font-size: 12px;
    padding: 5px 12px;
  }
  
  .interest-chip {
    font-size: 13px;
    padding: 6px 12px;
  }
  
  #emojiGrid {
    grid-template-columns: repeat(6, 1fr);
  }
  
  .emoji-btn-item {
    font-size: 20px;
    padding: 6px;
  }
}

@media (min-width: 1201px) {
  #homePage {
    flex-direction: row;
  }

  .sidebar {
    width: 300px;
  }
}
</style>
</head>

<body>

<!-- DESKTOP NAV -->
<nav>
  <h1>Potup</h1>
  
  <div class="nav-item active" data-page="homePage">
    <span class="material-icons">home</span>
    <span>Home</span>
  </div>
  
  <div class="nav-item" data-page="notificationsPage">
    <span class="material-icons">notifications</span>
    <span>Notifications</span>
    <span id="notificationBadge" class="notification-badge hidden">0</span>
  </div>
  
  <div class="nav-item" data-page="profilePage">
    <span class="material-icons">person</span>
    <span>Profile</span>
  </div>
  
  <div class="nav-item" data-page="settingsPage">
    <span class="material-icons">settings</span>
    <span>Settings</span>
  </div>
  
  <div class="nav-item" data-page="postPage">
    <span class="material-icons">add</span>
    <span>Post</span>
  </div>

  <div class="timer-widget">
    <h4>Time on Site</h4>
    <div class="timer-display" id="timerDisplay">00:00:00</div>
  </div>
</nav>

<!-- MOBILE BOTTOM NAV -->
<div class="mobile-nav">
  <div class="mobile-nav-items">
    <div class="mobile-nav-item active" data-page="homePage">
      <span class="material-icons">home</span>
    </div>
    
    <div class="mobile-nav-item" data-page="notificationsPage">
      <span class="material-icons">notifications</span>
      <span id="mobileNotificationBadge" class="mobile-notification-badge hidden">0</span>
    </div>

    <div class="mobile-nav-item" data-page="postPage">
      <span class="material-icons">add</span>
    </div>
    
    <div class="mobile-nav-item" data-page="profilePage">
      <span class="material-icons">person</span>
    </div>
    
    <div class="mobile-nav-item" data-page="settingsPage">
      <span class="material-icons">settings</span>
    </div>
  </div>
</div>

<main>
  <!-- HOME PAGE -->
  <div id="homePage" class="page active">
    <div class="feed-container">
      <div class="page-header">
        <h2>Home</h2>
        <div class="header-actions">
          <button class="icon-btn-header" id="mobileSearchBtn" style="display: none;">
            <span class="material-icons" style="font-size: 18px;">search</span>
          </button>
        </div>
      </div>

      <div class="feed-scroll-area">
        <h1 id="greeting" style="color: whitesmoke;">Good morning</h1>
        <h2 id="feedSubtext" style="color: whitesmoke;">Here's your feed-</h2>

        <div id="feed"></div>
      </div>
    </div>

    <div id="searchBar">
      <div class="search-widget">
        <h3>Search Users</h3>
        <div class="search-container">
          <input type="text" id="userSearch" placeholder="Search for users..." class="search-input">
        </div>
        <div id="searchResults" class="search-results"></div>
      </div>

      <div class="newssection">
        <h3>Latest News</h3>
        <div id="newsContainer" style="min-height: 60px;">
          <div class="loading-spinner">
            <div class="spinner"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- NOTIFICATIONS PAGE -->
  <div id="notificationsPage" class="page">
    <div style="flex: 1;">
      <div class="page-header">
        <h2>Notifications</h2>
      </div>
      <div id="notificationsList"></div>
    </div>
  </div>

  <!-- PROFILE PAGE -->
  <div id="profilePage" class="page">
    <div style="flex: 1;">
      <div class="page-header">
        <h2>Profile</h2>
        <div class="header-actions">
          <button class="icon-btn-header" onclick="shareProfile()">
            <span class="material-icons" style="font-size: 18px;">share</span>
            <span class="share-text">Share</span>
          </button>
        </div>
      </div>

      <div class="profile-banner"></div>
      
      <div class="profile-info">
        <label for="avatarUpload">
          <img id="profileAvatar" class="profile-avatar" src="https://i.imgur.com/6VBx3io.png">
        </label>
        <input type="file" id="avatarUpload" accept="image/*">

        <div class="profile-details">
          <div class="profile-name">
            <span id="profileName">Username</span>
            <div id="profileBadges"></div>
          </div>
          <div class="profile-username" id="profileUsername">@username</div>
          
          <div class="profile-bio">
            <textarea id="profileBioText" placeholder="Add your bio..." style="width: 100%; background: transparent; border: 1px solid var(--border-color); padding: 12px; border-radius: 12px; color: var(--text-primary); font-size: 15px; resize: vertical; min-height: 80px;" onblur="updateBio()"></textarea>
          </div>

          <div class="profile-stats">
            <div class="stat">
              <span class="stat-value" id="followersCount">0</span>
              <span class="stat-label">Followers</span>
            </div>
            <div class="stat">
              <span class="stat-value" id="followingCount">0</span>
              <span class="stat-label">Following</span>
            </div>
          </div>
          
          <div class="interests-section">
            <h3>Your Interests</h3>
            <div class="interests-grid" id="interestsGrid">
              <button type="button" class="interest-chip" data-interest="fun">ðŸŽ‰ Fun</button>
              <button type="button" class="interest-chip" data-interest="motivation">ðŸ’ª Motivation</button>
              <button type="button" class="interest-chip" data-interest="education">ðŸ“š Education</button>
              <button type="button" class="interest-chip" data-interest="tech">ðŸ’» Tech</button>
              <button type="button" class="interest-chip" data-interest="nature">ðŸŒ¿ Nature</button>
              <button type="button" class="interest-chip" data-interest="space">ðŸš€ Space</button>
              <button type="button" class="interest-chip" data-interest="interesting">âœ¨ Interesting</button>
            </div>
            <p class="interests-info">Select up to 3 interests to personalize your feed</p>
          </div>
        </div>
      </div>
      
      <div class="profile-posts-section">
        <div class="profile-posts-header">Your Posts</div>
        <div id="userPosts"></div>
      </div>
    </div>
  </div>

  <!-- VIEW PROFILE PAGE -->
  <div id="viewProfilePage" class="page">
    <div style="flex: 1;">
      <div class="page-header">
        <h2>Profile</h2>
      </div>

      <div class="profile-banner"></div>
      
      <div class="profile-info">
        <img id="viewProfileAvatar" class="profile-avatar" src="https://i.imgur.com/6VBx3io.png">

        <div class="profile-details">
          <div class="profile-name">
            <span id="viewProfileName">Username</span>
            <div id="viewProfileBadges"></div>
          </div>
          <div class="profile-username" id="viewProfileUsername">@username</div>
          
          <div class="profile-bio">
            <p id="viewProfileBio">No bio yet.</p>
          </div>

          <div class="profile-stats">
            <div class="stat">
              <span class="stat-value" id="viewFollowersCount">0</span>
              <span class="stat-label">Followers</span>
            </div>
            <div class="stat">
              <span class="stat-value" id="viewFollowingCount">0</span>
              <span class="stat-label">Following</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="profile-posts-section">
        <div class="profile-posts-header">Posts</div>
        <div id="viewUserPosts"></div>
      </div>
    </div>
  </div>

  <!-- SETTINGS PAGE -->
  <div id="settingsPage" class="page">
    <div class="glass-header">
      <h2>Settings</h2>
    </div>

    <div class="settings-section">
      <h3 class="section-title">Badge Eligibility</h3>
      <div class="badge-grid">
        <div class="badge-card">
          <span class="material-icons active-icon">verified</span>
          <h4>Verified</h4>
          <p>Professional profile & 100+ posts</p>
        </div>
        <div class="badge-card">
          <span class="material-icons elite-icon">stars</span>
          <h4>Elite</h4>
          <p>â‚¹200 Fees</p>
          <a href="payment_09-elite.html">
            <button class="text-btn" style="margin-top: 8px;">Get Elite</button>
          </a>
        </div>
        <div class="badge-card">
          <span class="material-icons active-user-icon">bolt</span>
          <h4>Active</h4>
          <p>Daily login for 30 days</p>
        </div>
      </div>
    </div>

    <div class="settings-section">
      <h3 class="section-title">Account & Preferences</h3>
      <a href="#" class="settings-item" onclick="showToast('Opening Terms and Conditions...'); return false;">
        <div class="settings-item-left">
          <span class="material-icons">description</span>
          <div class="item-text">
            <h4>Terms and Conditions</h4>
            <p>Our service agreement</p>
          </div>
        </div>
        <span class="material-icons chevron">chevron_right</span>
      </a>
    </div>

    <div class="settings-section">
      <h3 class="section-title">Logged-in Devices</h3>
      <div id="devicesList"></div>
    </div>

    <div class="settings-section">
      <h3 class="section-title">Support</h3>
      <div class="support-card">
        <div class="support-info">
          <span class="material-icons">support_agent</span>
          <div>
            <h4>Need help?</h4>
            <p>Contact us: <strong>tarchtechnologies@gmail.com</strong></p>
          </div>
        </div>
        <button class="contact-btn" onclick="emailSupport()">Email Us</button>
      </div>
    </div>

    <div class="settings-section">
      <button class="logout-full-btn" onclick="logout()">
        <span class="material-icons">logout</span>
        Log Out of All Devices
      </button>
    </div>
  </div>

  <!-- POST PAGE -->
  <div id="postPage" class="page">
    <div style="flex: 1;">
      <div class="page-header">
        <h2>Create Post</h2>
      </div>

      <div class="post-composer">
        <div class="composer-wrapper">
          <img id="composerAvatar" src="https://i.imgur.com/6VBx3io.png">
          <div class="composer-content">
            <textarea id="postContent" placeholder="What's happening?" rows="3" maxlength="500"></textarea>
            <div class="char-counter" id="charCounter">0 / 500</div>
            
            <div class="category-selector">
              <label>Select a category for your post *</label>
              <div class="category-options" id="postCategoryOptions">
                <button type="button" class="category-option" data-category="fun">ðŸŽ‰ Fun</button>
                <button type="button" class="category-option" data-category="motivation">ðŸ’ª Motivation</button>
                <button type="button" class="category-option" data-category="education">ðŸ“š Education</button>
                <button type="button" class="category-option" data-category="tech">ðŸ’» Tech</button>
                <button type="button" class="category-option" data-category="nature">ðŸŒ¿ Nature</button>
                <button type="button" class="category-option" data-category="space">ðŸš€ Space</button>
                <button type="button" class="category-option" data-category="interesting">âœ¨ Interesting</button>
                <button type="button" class="category-option" data-category="other">ðŸ“ Other</button>
              </div>
            </div>
            
            <div class="composer-actions">
              <div class="composer-icons">
                <button id="emojiBtn" class="icon-btn" type="button">
                  <span class="material-icons">sentiment_satisfied_alt</span>
                </button>
                <label for="postImage" class="icon-btn">
                  <span class="material-icons">image</span>
                </label>
                <input type="file" id="postImage" accept="image/*">
              </div>
              <button class="post-btn" onclick="createPost()">Post</button>
            </div>
            
            <div id="emojiPicker">
              <div id="emojiGrid"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- PROFILE MODAL -->
<div id="profileModal">
  <div class="modal-box">
    <span class="close" onclick="closeProfile()">âœ•</span>
    <img id="modalAvatar" class="modal-avatar">
    <div class="modal-content">
      <div class="modal-username" id="modalUserId"></div>
      <div id="modalBadges" class="modal-badges"></div>
      <p id="modalBio" class="modal-bio"></p>
      <div class="modal-actions">
        <button id="followBtn" class="modal-follow-btn"></button>
        <button class="modal-share-btn" onclick="shareModalProfile()">
          <span class="material-icons" style="font-size: 18px; vertical-align: middle;">share</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- MOBILE SEARCH MODAL -->
<div id="mobileSearchModal" class="mobile-search-modal">
  <div class="mobile-search-content">
    <div class="mobile-search-header">
      <h3>Search Users</h3>
      <button class="close-search" onclick="closeMobileSearch()">âœ•</button>
    </div>
    <div class="search-container">
      <input type="text" id="mobileUserSearch" placeholder="Search for users..." class="search-input">
    </div>
    <div id="mobileSearchResults" class="search-results"></div>
  </div>
</div>

<!-- REPLY MODAL -->
<div id="replyModal" class="reply-modal">
  <div class="reply-modal-content">
    <div class="reply-modal-header">
      <h3>Replies</h3>
      <button class="close-reply" onclick="closeReplyModal()">âœ•</button>
    </div>
    <div class="reply-to">
      Replying to <span id="replyModalPostAuthor"></span>
    </div>
    <div class="reply-composer">
      <textarea id="replyContent" placeholder="Write your reply..." maxlength="500"></textarea>
      <div style="display: flex; justify-content: flex-end; margin-top: 12px;">
        <button class="post-btn" onclick="submitReply()">Reply</button>
      </div>
    </div>
    <div class="replies-list">
      <h4>All Replies</h4>
      <div id="repliesList"></div>
    </div>
  </div>
</div>

<script>
const SUPABASE_URL = "https://hdauaegfmenlzhqnfgvy.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhkYXVhZWdmbWVubHpocW5mZ3Z5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NDc0MzAsImV4cCI6MjA4MTAyMzQzMH0.8IHXBnKm6pE5cwBGPo7m0eIWdtVPsQDL1CUozebpNDE";
const IMGBB_API_KEY = "9360a2ebd6e3f0d47def9d8d34db622b";

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const userUUID = localStorage.getItem("id");
let myUserIdText = null;
let viewedUUID = null;
let currentUserData = null;
let allPosts = [];
let displayedPostsCount = 0;
const POSTS_PER_LOAD = 10;
let isLoading = false;
let emojisLoaded = false;
let allEmojis = [];
let selectedPostCategory = null;
let userInterests = [];
let unreadNotifications = 0;
let userLikes = new Set();
let userReposts = new Set();
let currentReplyPostId = null;
let timeOnSite = 0;
let timerInterval = null;

function setGreeting() {
  const now = new Date();
  const hour = now.getHours();
  let greeting = "Good morning";
  let subtext = "Here's your feed-";
  if (hour >= 12 && hour < 17) {
    greeting = "Good afternoon";
  } else if (hour >= 17) {
    greeting = "Good evening";
  }
  document.getElementById('greeting').textContent = greeting + ", " + currentUserData.user_id;
  document.getElementById('feedSubtext').textContent = subtext;
}

function startTimer() {
  const savedTime = localStorage.getItem('timeOnSite_' + userUUID);
  if (savedTime) {
    timeOnSite = parseInt(savedTime);
  }
  
  updateTimerDisplay();
  
  timerInterval = setInterval(() => {
    timeOnSite++;
    updateTimerDisplay();
    localStorage.setItem('timeOnSite_' + userUUID, timeOnSite.toString());
  }, 1000);
}

function updateTimerDisplay() {
  const hours = Math.floor(timeOnSite / 3600);
  const minutes = Math.floor((timeOnSite % 3600) / 60);
  const seconds = timeOnSite % 60;
  
  const display = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  document.getElementById('timerDisplay').textContent = display;
}

document.addEventListener("DOMContentLoaded", async () => {
  if (!userUUID) {
    const urlParams = new URLSearchParams(window.location.search);
    const profileId = urlParams.get('profile');
    if (profileId) {
      await loadSharedProfile(profileId);
      return;
    }
    location.href = "log-in.html";
    return;
  }
  
  await loadProfile();
  await loadUserLikes();
  await loadUserReposts();
  await loadAllPosts();
  displayPosts();
  setGreeting();
  await loadNotifications();
  await loadNews();
  
  setupNavigation();
  setupMobileNavigation();
  setupAvatarUpload();
  setupInfiniteScroll();
  setupEmojiPicker();
  setupCategorySelector();
  setupInterestsSelector();
  setupSearch();
  setupMobileSearch();
  setupCharCounter();
  
  setupRealtimeNotifications();
  startTimer();
});

function setupCharCounter() {
  const textarea = document.getElementById('postContent');
  const counter = document.getElementById('charCounter');
  
  textarea.addEventListener('input', () => {
    const length = textarea.value.length;
    counter.textContent = `${length} / 500`;
    
    if (length > 450) {
      counter.classList.add('error');
      counter.classList.remove('warning');
    } else if (length > 400) {
      counter.classList.add('warning');
      counter.classList.remove('error');
    } else {
      counter.classList.remove('warning', 'error');
    }
  });
}

function setupMobileSearch() {
  const btn = document.getElementById('mobileSearchBtn');
  const modal = document.getElementById('mobileSearchModal');
  const input = document.getElementById('mobileUserSearch');
  
  if (window.innerWidth <= 768) {
    btn.style.display = 'flex';
  }
  
  btn.addEventListener('click', () => {
    modal.style.display = 'block';
    input.focus();
  });
  
  input.addEventListener('input', debounce(() => mobileSearchUsers(), 300));
}

function closeMobileSearch() {
  document.getElementById('mobileSearchModal').style.display = 'none';
  document.getElementById('mobileUserSearch').value = '';
  document.getElementById('mobileSearchResults').innerHTML = '';
}

async function mobileSearchUsers() {
  const query = document.getElementById("mobileUserSearch").value.trim();
  const resultsContainer = document.getElementById("mobileSearchResults");
  
  if (!query) {
    resultsContainer.innerHTML = "";
    return;
  }
  
  try {
    const { data: users } = await sb
      .from("user_profiles")
      .select("user_id, avatar_url")
      .ilike("user_id", `%${query}%`)
      .limit(5);
    
    resultsContainer.innerHTML = "";
    
    if (users && users.length > 0) {
      users.slice(0, 5).forEach(user => {
        const userElement = document.createElement("div");
        userElement.className = "search-result-item";
        userElement.onclick = () => {
          openProfile(user.user_id);
          closeMobileSearch();
        };
        
        userElement.innerHTML = `
          <img src="${user.avatar_url || 'https://i.imgur.com/6VBx3io.png'}" alt="${user.user_id}" class="search-result-avatar">
          <div class="search-result-info">
            <h4>${user.user_id}</h4>
          </div>
        `;
        
        resultsContainer.appendChild(userElement);
      });
    } else {
      resultsContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">No users found</div>';
    }
  } catch (error) {
    console.error("Search error:", error);
    resultsContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">Error searching users</div>';
  }
}

async function loadNews() {
  try {
    const response = await fetch('https://api.rss2json.com/v1/api.json?rss_url=' + encodeURIComponent('https://news.google.com/rss?hl=en-US&gl=US&ceid=US:en'));
    const data = await response.json();
    
    if (data.items && data.items.length > 0) {
      const item = data.items[0];
      
      const newsContainer = document.getElementById('newsContainer');
      newsContainer.innerHTML = `
        <div class="news-item" onclick="window.open('${item.link}', '_blank')">
          <strong>${item.title}</strong>
          <div style="font-size: 12px; color: rgba(255, 255, 255, 0.5); margin-top: 8px;">
            ${new Date(item.pubDate).toLocaleDateString()}
          </div>
        </div>
      `;
    }
  } catch (error) {
    console.error('Failed to load news:', error);
    document.getElementById('newsContainer').innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary); font-size: 13px;">Unable to load news</div>';
  }
}

function setupNavigation() {
  document.querySelectorAll(".nav-item").forEach(item => {
    item.addEventListener("click", async () => {
      document.querySelectorAll(".nav-item").forEach(i => i.classList.remove("active"));
      item.classList.add("active");
      
      document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
      
      const pageId = item.getAttribute("data-page");
      document.getElementById(pageId).classList.add("active");
      
      if (pageId === "profilePage") {
        await loadProfilePage();
        await loadUserPosts();
      } else if (pageId === "notificationsPage") {
        await markNotificationsAsRead();
        await loadNotifications();
      }
    });
  });
}

function setupMobileNavigation() {
  document.querySelectorAll(".mobile-nav-item").forEach(item => {
    item.addEventListener("click", async () => {
      document.querySelectorAll(".mobile-nav-item").forEach(i => i.classList.remove("active"));
      item.classList.add("active");
      
      document.querySelectorAll(".nav-item").forEach(i => i.classList.remove("active"));
      
      document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
      
      const pageId = item.getAttribute("data-page");
      document.getElementById(pageId).classList.add("active");
      
      const matchingNavItem = document.querySelector(`.nav-item[data-page="${pageId}"]`);
      if (matchingNavItem) {
        matchingNavItem.classList.add("active");
      }
      
      if (pageId === "profilePage") {
        await loadProfilePage();
        await loadUserPosts();
      } else if (pageId === "notificationsPage") {
        await markNotificationsAsRead();
        await loadNotifications();
      }
    });
  });
}

function setupCategorySelector() {
  const categoryOptions = document.querySelectorAll('#postCategoryOptions .category-option');
  
  categoryOptions.forEach(option => {
    option.addEventListener('click', () => {
      categoryOptions.forEach(opt => opt.classList.remove('selected'));
      option.classList.add('selected');
      selectedPostCategory = option.getAttribute('data-category');
    });
  });
}


function setupInterestsSelector() {
  const interestChips = document.querySelectorAll('#interestsGrid .interest-chip');
  
  interestChips.forEach(chip => {
    chip.addEventListener('click', async () => {
      const interest = chip.getAttribute('data-interest');
      
      if (chip.classList.contains('selected')) {
        chip.classList.remove('selected');
        userInterests = userInterests.filter(i => i !== interest);
      } else {
        if (userInterests.length >= 3) {
          alert('You can select up to 3 interests only!');
          return;
        }
        chip.classList.add('selected');
        userInterests.push(interest);
      }
      
      interestChips.forEach(c => {
        if (!c.classList.contains('selected')) {
          c.disabled = userInterests.length >= 3;
        }
      });
      
      await saveInterests();
    });
  });
}

async function saveInterests() {
  await sb.from("user_profiles")
    .update({ interests: userInterests.join(',') })
    .eq("id", userUUID);
  
  currentUserData.interests = userInterests.join(',');
  
  document.getElementById("feed").innerHTML = "";
  displayedPostsCount = 0;
  await loadAllPosts();
  displayPosts();
}

function loadInterestsUI() {
  const interestChips = document.querySelectorAll('#interestsGrid .interest-chip');
  
  interestChips.forEach(chip => {
    const interest = chip.getAttribute('data-interest');
    if (userInterests.includes(interest)) {
      chip.classList.add('selected');
    } else {
      chip.classList.remove('selected');
    }
    chip.disabled = userInterests.length >= 3 && !chip.classList.contains('selected');
  });
}

function setupInfiniteScroll() {
  const feedScrollArea = document.querySelector('.feed-scroll-area');
  
  feedScrollArea.addEventListener('scroll', () => {
    if (isLoading) return;
    
    const scrollTop = feedScrollArea.scrollTop;
    const scrollHeight = feedScrollArea.scrollHeight;
    const clientHeight = feedScrollArea.clientHeight;
    
    if (scrollTop + clientHeight >= scrollHeight - 200) {
      if (displayedPostsCount < allPosts.length) {
        displayPosts();
      }
    }
  });
}

async function loadProfile() {
  const { data } = await sb
    .from("user_profiles")
    .select("*")
    .eq("id", userUUID)
    .single();

  currentUserData = data;
  myUserIdText = data.user_id;
  
  if (data.interests) {
    userInterests = data.interests.split(',').filter(i => i.trim());
  } else {
    userInterests = [];
  }
  
  const avatarUrl = data.avatar_url || "https://i.imgur.com/6VBx3io.png";
  document.getElementById("composerAvatar").src = avatarUrl;
}

async function loadUserLikes() {
  const { data } = await sb
    .from("likes")
    .select("post_id")
    .eq("user_id", userUUID);
  
  if (data) {
    userLikes = new Set(data.map(like => like.post_id));
  }
}

async function loadUserReposts() {
  const { data } = await sb
    .from("reposts")
    .select("post_id")
    .eq("user_id", userUUID);
  
  if (data) {
    userReposts = new Set(data.map(repost => repost.post_id));
  }
}

async function loadProfilePage() {
  if (!currentUserData) return;
  
  const avatarUrl = currentUserData.avatar_url || "https://i.imgur.com/6VBx3io.png";
  document.getElementById("profileAvatar").src = avatarUrl;
  document.getElementById("profileName").innerText = currentUserData.user_id;
  document.getElementById("profileUsername").innerText = "@" + currentUserData.user_id;
  document.getElementById("profileBioText").value = currentUserData.bio || "";
  document.getElementById("followersCount").innerText = currentUserData.followers || 0;
  
  const { data: followingData } = await sb
    .from("follows")
    .select("id")
    .eq("follower_id", userUUID);
  document.getElementById("followingCount").innerText = followingData ? followingData.length : 0;
  
  const badgesContainer = document.getElementById("profileBadges");
  badgesContainer.innerHTML = "";
  if (currentUserData.badges) {
    currentUserData.badges.split(",").forEach(b => {
      const badge = b.trim().toLowerCase();
      badgesContainer.innerHTML += `<span class="badge ${badge}">${b.trim()}</span>`;
    });
  }
  
  loadInterestsUI();
}

async function loadUserPosts() {
  const { data: posts } = await sb
    .from("posts")
    .select("*")
    .eq("author", myUserIdText)
    .order("created_at", { ascending: false });
  
  const userPostsContainer = document.getElementById("userPosts");
  userPostsContainer.innerHTML = "";
  
  if (!posts || posts.length === 0) {
    userPostsContainer.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">No posts yet</div>';
    return;
  }
  
  const postIds = posts.map(p => p.id);
  const { data: likeCounts } = await sb
    .from("likes")
    .select("post_id")
    .in("post_id", postIds);
  
  const { data: replyCounts } = await sb
    .from("replies")
    .select("post_id")
    .in("post_id", postIds);
  
  const { data: repostCounts } = await sb
    .from("reposts")
    .select("post_id")
    .in("post_id", postIds);
  
  const likeCountMap = {};
  const replyCountMap = {};
  const repostCountMap = {};
  
  if (likeCounts) {
    likeCounts.forEach(like => {
      likeCountMap[like.post_id] = (likeCountMap[like.post_id] || 0) + 1;
    });
  }
  
  if (replyCounts) {
    replyCounts.forEach(reply => {
      replyCountMap[reply.post_id] = (replyCountMap[reply.post_id] || 0) + 1;
    });
  }
  
  if (repostCounts) {
    repostCounts.forEach(repost => {
      repostCountMap[repost.post_id] = (repostCountMap[repost.post_id] || 0) + 1;
    });
  }
  
  posts.forEach(p => {
    const avatarUrl = currentUserData.avatar_url || "https://i.imgur.com/6VBx3io.png";
    
    let badgesHTML = "";
    if (currentUserData.badges) {
      currentUserData.badges.split(",").forEach(b => {
        const badge = b.trim().toLowerCase();
        badgesHTML += `<span class="badge ${badge}">${b.trim()}</span>`;
      });
    }
    
    const timeAgo = getTimeAgo(new Date(p.created_at));
    const categoryEmojis = {
      'fun': 'ðŸŽ‰',
      'motivation': 'ðŸ’ª',
      'education': 'ðŸ“š',
      'tech': 'ðŸ’»',
      'nature': 'ðŸŒ¿',
      'space': 'ðŸš€',
      'interesting': 'âœ¨',
      'other': 'ðŸ“'
    };
    const categoryLabel = p.type ? `${categoryEmojis[p.type] || ''} ${p.type}` : '';
    
    const isLiked = userLikes.has(p.id);
    const isReposted = userReposts.has(p.id);
    const likeIcon = isLiked ? 'favorite' : 'favorite_border';
    const likeClass = isLiked ? 'liked' : '';
    const repostClass = isReposted ? 'reposted' : '';
    const likeCount = likeCountMap[p.id] || 0;
    const replyCount = replyCountMap[p.id] || 0;
    const repostCount = repostCountMap[p.id] || 0;
    
    const postElement = document.createElement('div');
    postElement.className = 'post';
    postElement.innerHTML = `
      <div class="post-content-wrapper">
        <img class="post-avatar" src="${avatarUrl}">
        <div class="post-main">
          <div class="post-header">
            <span class="username">${p.author}</span>
            ${badgesHTML}
            <span class="post-time">Â· ${timeAgo}</span>
            ${categoryLabel ? `<span class="post-category">${categoryLabel}</span>` : ''}
          </div>
          <p class="post-text">${p.content || ""}</p>
          ${p.image_url ? `<img class="post-img" src="${p.image_url}">` : ""}
          <div class="post-actions">
            <button class="action-btn ${likeClass}" onclick="toggleLike('${p.id}', this)" data-post-id="${p.id}">
              <span class="material-icons">${likeIcon}</span>
              <span class="like-count">${likeCount}</span>
            </button>
            <button class="action-btn reply-btn" onclick="openReplyModal('${p.id}', '${p.author}')">
              <span class="material-icons">chat_bubble_outline</span>
              <span class="reply-count">${replyCount}</span>
            </button>
            <button class="action-btn repost-btn ${repostClass}" onclick="toggleRepost('${p.id}', this)">
              <span class="material-icons">repeat</span>
              <span class="repost-count">${repostCount}</span>
            </button>
          </div>
        </div>
      </div>
    `;
    
    userPostsContainer.appendChild(postElement);
  });
}

async function updateBio() {
  const bio = document.getElementById("profileBioText").value;
  await sb.from("user_profiles").update({ bio }).eq("id", userUUID);
  currentUserData.bio = bio;
}

function setupAvatarUpload() {
  document.getElementById("avatarUpload").addEventListener("change", async (e) => {
    if (e.target.files[0]) {
      const imageUrl = await uploadImage(e.target.files[0]);
      await sb.from("user_profiles").update({ avatar_url: imageUrl }).eq("id", userUUID);
      document.getElementById("profileAvatar").src = imageUrl;
      document.getElementById("composerAvatar").src = imageUrl;
      currentUserData.avatar_url = imageUrl;
    }
  });
}

async function loadAllPosts() {
  const { data: posts } = await sb
    .from("posts")
    .select("*")
    .order("created_at", { ascending: false });
    
  const { data: profiles } = await sb
    .from("user_profiles")
    .select("user_id, avatar_url, badges");

  const postIds = posts.map(p => p.id);
  const { data: likeCounts } = await sb
    .from("likes")
    .select("post_id")
    .in("post_id", postIds);
  
  const { data: replyCounts } = await sb
    .from("replies")
    .select("post_id")
    .in("post_id", postIds);
  
  const { data: repostCounts } = await sb
    .from("reposts")
    .select("post_id")
    .in("post_id", postIds);
  
  const likeCountMap = {};
  const replyCountMap = {};
  const repostCountMap = {};
  
  if (likeCounts) {
    likeCounts.forEach(like => {
      likeCountMap[like.post_id] = (likeCountMap[like.post_id] || 0) + 1;
    });
  }
  
  if (replyCounts) {
    replyCounts.forEach(reply => {
      replyCountMap[reply.post_id] = (replyCountMap[reply.post_id] || 0) + 1;
    });
  }
  
  if (repostCounts) {
    repostCounts.forEach(repost => {
      repostCountMap[repost.post_id] = (repostCountMap[repost.post_id] || 0) + 1;
    });
  }

  let enrichedPosts = posts.map(p => {
    const prof = profiles.find(u => u.user_id === p.author) || {};
    return {
      ...p,
      profile: prof,
      actualLikes: likeCountMap[p.id] || 0,
      actualReplies: replyCountMap[p.id] || 0,
      actualReposts: repostCountMap[p.id] || 0
    };
  });
  
  allPosts = applySmartAlgorithm(enrichedPosts);
  displayedPostsCount = 0;
}

function applySmartAlgorithm(posts) {
  const adPosts = posts.filter(p => p.profile.badges && p.profile.badges.toLowerCase().includes('ad'));
  const regularPosts = posts.filter(p => !(p.profile.badges && p.profile.badges.toLowerCase().includes('ad')));
  
  let relevantAdPosts = adPosts;
  if (userInterests.length > 0) {
    const interestedAds = adPosts.filter(p => userInterests.includes(p.type));
    const otherAds = adPosts.filter(p => !userInterests.includes(p.type));
    relevantAdPosts = [...shuffleArray(interestedAds), ...shuffleArray(otherAds)];
  } else {
    relevantAdPosts = shuffleArray(adPosts);
  }
  
  let sortedRegularPosts;
  if (userInterests.length === 0) {
    sortedRegularPosts = shuffleArray(regularPosts);
  } else {
    const interestedPosts = regularPosts.filter(p => userInterests.includes(p.type));
    const otherPosts = regularPosts.filter(p => !userInterests.includes(p.type));
    sortedRegularPosts = [...shuffleArray(interestedPosts), ...shuffleArray(otherPosts)];
  }
  
  const finalPosts = [];
  let adIndex = 0;
  
  for (let i = 0; i < sortedRegularPosts.length; i++) {
    finalPosts.push(sortedRegularPosts[i]);
    
    if ((i + 1) % 10 === 0 && adIndex < relevantAdPosts.length) {
      finalPosts.push(relevantAdPosts[adIndex]);
      adIndex++;
    }
  }
  
  while (adIndex < relevantAdPosts.length) {
    finalPosts.push(relevantAdPosts[adIndex]);
    adIndex++;
  }
  
  return finalPosts;
}

function shuffleArray(array) {
  const shuffled = [...array];
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  return shuffled;
}

function displayPosts() {
  if (isLoading) return;
  isLoading = true;
  
  const feed = document.getElementById("feed");
  const postsToShow = allPosts.slice(displayedPostsCount, displayedPostsCount + POSTS_PER_LOAD);
  
  postsToShow.forEach(p => {
    const avatarUrl = p.profile.avatar_url || "https://i.imgur.com/6VBx3io.png";
    
    let badgesHTML = "";
    if (p.profile.badges) {
      p.profile.badges.split(",").forEach(b => {
        const badge = b.trim().toLowerCase();
        badgesHTML += `<span class="badge ${badge}">${b.trim()}</span>`;
      });
    }
    
    const timeAgo = getTimeAgo(new Date(p.created_at));
    const categoryEmojis = {
      'fun': 'ðŸŽ‰',
      'motivation': 'ðŸ’ª',
      'education': 'ðŸ“š',
      'tech': 'ðŸ’»',
      'nature': 'ðŸŒ¿',
      'space': 'ðŸš€',
      'interesting': 'âœ¨',
      'other': 'ðŸ“'
    };
    const categoryLabel = p.type ? `${categoryEmojis[p.type] || ''} ${p.type}` : '';
    
    const isLiked = userLikes.has(p.id);
    const isReposted = userReposts.has(p.id);
    const likeIcon = isLiked ? 'favorite' : 'favorite_border';
    const likeClass = isLiked ? 'liked' : '';
    const repostClass = isReposted ? 'reposted' : '';
    const likeCount = p.actualLikes || 0;
    const replyCount = p.actualReplies || 0;
    const repostCount = p.actualReposts || 0;
    
    const postElement = document.createElement('div');
    postElement.className = 'post';
    postElement.innerHTML = `
      <div class="post-content-wrapper">
        <img class="post-avatar" src="${avatarUrl}">
        <div class="post-main">
          <div class="post-header">
            <span class="username" onclick="openProfile('${p.author}')">${p.author}</span>
            ${badgesHTML}
            <span class="post-time">Â· ${timeAgo}</span>
            ${categoryLabel ? `<span class="post-category">${categoryLabel}</span>` : ''}
          </div>
          <p class="post-text">${p.content || ""}</p>
          ${p.image_url ? `<img class="post-img" src="${p.image_url}">` : ""}
          <div class="post-actions">
            <button class="action-btn ${likeClass}" onclick="toggleLike('${p.id}', this)" data-post-id="${p.id}">
              <span class="material-icons">${likeIcon}</span>
              <span class="like-count">${likeCount}</span>
            </button>
            <button class="action-btn reply-btn" onclick="openReplyModal('${p.id}', '${p.author}')">
              <span class="material-icons">chat_bubble_outline</span>
              <span class="reply-count">${replyCount}</span>
            </button>
            <button class="action-btn repost-btn ${repostClass}" onclick="toggleRepost('${p.id}', this)">
              <span class="material-icons">repeat</span>
              <span class="repost-count">${repostCount}</span>
            </button>
          </div>
        </div>
      </div>
    `;
    
    feed.appendChild(postElement);
  });
  
  displayedPostsCount += postsToShow.length;
  isLoading = false;
}

function getTimeAgo(date) {
  const seconds = Math.floor((new Date() - date) / 1000);
  const intervals = {
    year: 31536000,
    month: 2592000,
    week: 604800,
    day: 86400,
    hour: 3600,
    minute: 60
  };
  
  for (let [unit, secondsInUnit] of Object.entries(intervals)) {
    const interval = Math.floor(seconds / secondsInUnit);
    if (interval >= 1) {
      return interval === 1 ? `1 ${unit} ago` : `${interval} ${unit}s ago`;
    }
  }
  return "just now";
}

async function createPost() {
  const content = document.getElementById("postContent").value;
  
  if (!content.trim()) {
    alert('Please write something!');
    return;
  }
  
  if (!selectedPostCategory) {
    alert('Please select a category for your post!');
    return;
  }
  
  let imageUrl = null;
  const fileInput = document.getElementById("postImage");
  if (fileInput.files[0]) {
    imageUrl = await uploadImage(fileInput.files[0]);
  }

  await sb.from("posts").insert({
    author: myUserIdText,
    content: content,
    image_url: imageUrl,
    type: selectedPostCategory,
    likes: 0
  });

  document.getElementById("postContent").value = "";
  document.getElementById("charCounter").textContent = "0 / 500";
  fileInput.value = "";
  selectedPostCategory = null;
  document.querySelectorAll('#postCategoryOptions .category-option').forEach(opt => {
    opt.classList.remove('selected');
  });
  
  showToast('Post created successfully!');
  
  document.getElementById("feed").innerHTML = "";
  await loadAllPosts();
  displayPosts();
}

async function toggleLike(postId, buttonElement) {
  if (buttonElement.disabled) return;
  buttonElement.disabled = true;
  
  const isCurrentlyLiked = userLikes.has(postId);
  
  try {
    if (isCurrentlyLiked) {
      await sb
        .from("likes")
        .delete()
        .eq("post_id", postId)
        .eq("user_id", userUUID);
      
      userLikes.delete(postId);
      
      const icon = buttonElement.querySelector('.material-icons');
      const count = buttonElement.querySelector('.like-count');
      icon.textContent = 'favorite_border';
      buttonElement.classList.remove('liked');
      count.textContent = Math.max(0, parseInt(count.textContent) - 1);
      
    } else {
      await sb
        .from("likes")
        .insert({
          post_id: postId,
          user_id: userUUID
        });
      
      userLikes.add(postId);
      
      const icon = buttonElement.querySelector('.material-icons');
      const count = buttonElement.querySelector('.like-count');
      icon.textContent = 'favorite';
      buttonElement.classList.add('liked');
      count.textContent = parseInt(count.textContent) + 1;
      
      const { data: post } = await sb
        .from("posts")
        .select("author")
        .eq("id", postId)
        .single();
      
      if (post && post.author !== myUserIdText) {
        const { data: authorProfile } = await sb
          .from("user_profiles")
          .select("id")
          .eq("user_id", post.author)
          .single();
        
        if (authorProfile) {
          await sb.from("notifications").insert({
            user_id: authorProfile.id,
            type: 'like',
            message: `<strong>${myUserIdText}</strong> liked your post`,
            from_user: myUserIdText,
            read: false
          });
        }
      }
    }
  } catch (error) {
    console.error('Error toggling like:', error);
    showToast('Failed to update like. Please try again.');
  } finally {
    buttonElement.disabled = false;
  }
}

async function toggleRepost(postId, buttonElement) {
  if (buttonElement.disabled) return;
  buttonElement.disabled = true;
  
  const isCurrentlyReposted = userReposts.has(postId);
  
  try {
    if (isCurrentlyReposted) {
      await sb
        .from("reposts")
        .delete()
        .eq("post_id", postId)
        .eq("user_id", userUUID);
      
      userReposts.delete(postId);
      
      const count = buttonElement.querySelector('.repost-count');
      buttonElement.classList.remove('reposted');
      count.textContent = Math.max(0, parseInt(count.textContent) - 1);
      
      showToast('Repost removed');
      
    } else {
      await sb
        .from("reposts")
        .insert({
          post_id: postId,
          user_id: userUUID
        });
      
      userReposts.add(postId);
      
      const count = buttonElement.querySelector('.repost-count');
      buttonElement.classList.add('reposted');
      count.textContent = parseInt(count.textContent) + 1;
      
      showToast('Reposted successfully!');
    }
  } catch (error) {
    console.error('Error toggling repost:', error);
    showToast('Failed to repost. Please try again.');
  } finally {
    buttonElement.disabled = false;
  }
}

async function openReplyModal(postId, postAuthor) {
  currentReplyPostId = postId;
  document.getElementById('replyModalPostAuthor').textContent = `@${postAuthor}`;
  document.getElementById('replyContent').value = '';
  document.getElementById('replyModal').style.display = 'flex';
  
  await loadRepliesForPost(postId);
}

function closeReplyModal() {
  document.getElementById('replyModal').style.display = 'none';
  currentReplyPostId = null;
}

async function loadRepliesForPost(postId) {
  const repliesContainer = document.getElementById('repliesList');
  repliesContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">Loading replies...</div>';
  
  const { data: replies } = await sb
    .from("replies")
    .select("*")
    .eq("post_id", postId)
    .order("created_at", { ascending: false });
  
  if (!replies || replies.length === 0) {
    repliesContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">No replies yet. Be the first to reply!</div>';
    return;
  }
  
  const userIds = [...new Set(replies.map(r => r.user_id))];
  const { data: profiles } = await sb
    .from("user_profiles")
    .select("id, user_id, avatar_url, badges")
    .in("id", userIds);
  
  repliesContainer.innerHTML = '';
  
  replies.forEach(reply => {
    const profile = profiles.find(p => p.id === reply.user_id) || {};
    const avatarUrl = profile.avatar_url || "https://i.imgur.com/6VBx3io.png";
    
    let badgesHTML = "";
    if (profile.badges) {
      profile.badges.split(",").forEach(b => {
        const badge = b.trim().toLowerCase();
        badgesHTML += `<span class="badge ${badge}">${b.trim()}</span>`;
      });
    }
    
    const timeAgo = getTimeAgo(new Date(reply.created_at));
    
    const replyElement = document.createElement('div');
    replyElement.className = 'reply-item';
    replyElement.innerHTML = `
      <img class="reply-avatar" src="${avatarUrl}">
      <div class="reply-content-wrapper">
        <div class="reply-header">
          <span class="username" onclick="openProfile('${profile.user_id}')">${profile.user_id}</span>
          ${badgesHTML}
          <span class="post-time">Â· ${timeAgo}</span>
        </div>
        <p class="reply-text">${reply.content}</p>
      </div>
    `;
    
    repliesContainer.appendChild(replyElement);
  });
}

async function submitReply() {
  const content = document.getElementById('replyContent').value.trim();
  
  if (!content) {
    showToast('Please write a reply!');
    return;
  }
  
  if (!currentReplyPostId) return;
  
  const submitBtn = document.querySelector('#replyModal .post-btn');
  submitBtn.disabled = true;
  
  try {
    await sb.from("replies").insert({
      post_id: currentReplyPostId,
      user_id: userUUID,
      content: content
    });
    
    const allReplyButtons = document.querySelectorAll('.reply-btn');
    allReplyButtons.forEach(btn => {
      const postCard = btn.closest('.post');
      if (postCard) {
        const postId = btn.closest('.post-actions').querySelector('[data-post-id]').dataset.postId;
        if (postId === currentReplyPostId) {
          const replyCount = btn.querySelector('.reply-count');
          replyCount.textContent = parseInt(replyCount.textContent) + 1;
        }
      }
    });
    
    document.getElementById('replyContent').value = '';
    await loadRepliesForPost(currentReplyPostId);
    
    showToast('Reply posted successfully!');
  } catch (error) {
    console.error('Error posting reply:', error);
    showToast('Failed to post reply. Please try again.');
  } finally {
    submitBtn.disabled = false;
  }
}

async function loadNotifications() {
  const { data: notifications } = await sb
    .from("notifications")
    .select("*")
    .eq("user_id", userUUID)
    .order("created_at", { ascending: false })
    .limit(50);
  
  const notificationsList = document.getElementById("notificationsList");
  
  if (!notifications || notifications.length === 0) {
    notificationsList.innerHTML = `
      <div class="no-notifications">
        <span class="material-icons" style="font-size: 48px; margin-bottom: 16px;">notifications_none</span>
        <p>No notifications yet</p>
      </div>
    `;
    return;
  }
  
  notificationsList.innerHTML = "";
  
  notifications.forEach(notif => {
    let iconClass = 'system';
    let icon = 'campaign';
    
    if (notif.type === 'follow') {
      iconClass = 'follow';
      icon = 'person_add';
    } else if (notif.type === 'like') {
      iconClass = 'like';
      icon = 'favorite';
    }
    
    const timeAgo = getTimeAgo(new Date(notif.created_at));
    
    const notifElement = document.createElement('div');
    notifElement.className = `notification-item ${notif.read ? '' : 'unread'}`;
    notifElement.innerHTML = `
      <div class="notification-icon ${iconClass}">
        <span class="material-icons">${icon}</span>
      </div>
      <div class="notification-content">
        <div class="notification-text">${notif.message}</div>
        <div class="notification-time">${timeAgo}</div>
      </div>
    `;
    
    if (notif.from_user) {
      notifElement.onclick = () => openProfile(notif.from_user);
    }
    
    notificationsList.appendChild(notifElement);
  });
  
  updateNotificationBadge();
}

async function updateNotificationBadge() {
  const { count } = await sb
    .from("notifications")
    .select("id", { count: 'exact' })
    .eq("user_id", userUUID)
    .eq("read", false);
  
  const badge = document.getElementById("notificationBadge");
  const mobileBadge = document.getElementById("mobileNotificationBadge");
  
  if (count > 0) {
    const displayCount = count > 99 ? '99+' : count;
    badge.textContent = displayCount;
    badge.classList.remove("hidden");
    mobileBadge.textContent = displayCount;
    mobileBadge.classList.remove("hidden");
  } else {
    badge.classList.add("hidden");
    mobileBadge.classList.add("hidden");
  }
  
  unreadNotifications = count;
}

async function markNotificationsAsRead() {
  await sb
    .from("notifications")
    .update({ read: true })
    .eq("user_id", userUUID)
    .eq("read", false);
  
  updateNotificationBadge();
}

function setupRealtimeNotifications() {
  sb.channel('notifications')
    .on('postgres_changes', {
      event: 'INSERT',
      schema: 'public',
      table: 'notifications',
      filter: `user_id=eq.${userUUID}`
    }, (payload) => {
      updateNotificationBadge();
      showToast(payload.new.message);
    })
    .subscribe();
}

function showToast(message) {
  const toast = document.createElement('div');
  toast.style.cssText = `
    position: fixed;
    bottom: 80px;
    right: 20px;
    left: 20px;
    max-width: 400px;
    margin: 0 auto;
    background: var(--accent);
    color: white;
    padding: 16px 24px;
    border-radius: 12px;
    font-size: 14px;
    z-index: 10000;
    animation: slideIn 0.3s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  `;
  toast.textContent = message;
  document.body.appendChild(toast);
  
  setTimeout(() => {
    toast.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => toast.remove(), 300);
  }, 3000);
}

async function searchUsers() {
  const query = document.getElementById("userSearch").value.trim();
  const resultsContainer = document.getElementById("searchResults");
  
  if (!query) {
    resultsContainer.innerHTML = "";
    return;
  }
  
  try {
    const { data: users } = await sb
      .from("user_profiles")
      .select("user_id, avatar_url")
      .ilike("user_id", `%${query}%`)
      .limit(5);
    
    resultsContainer.innerHTML = "";
    
    if (users && users.length > 0) {
      users.slice(0, 5).forEach(user => {
        const userElement = document.createElement("div");
        userElement.className = "search-result-item";
        userElement.onclick = () => openProfile(user.user_id);
        
        userElement.innerHTML = `
          <img src="${user.avatar_url || 'https://i.imgur.com/6VBx3io.png'}" alt="${user.user_id}" class="search-result-avatar">
          <div class="search-result-info">
            <h4>${user.user_id}</h4>
          </div>
        `;
        
        resultsContainer.appendChild(userElement);
      });
    } else {
      resultsContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">No users found</div>';
    }
  } catch (error) {
    console.error("Search error:", error);
    resultsContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">Error searching users</div>';
  }
}

async function openProfile(userIdText) {
  const { data } = await sb
    .from("user_profiles")
    .select("*")
    .eq("user_id", userIdText)
    .single();
  if (!data) return;
  viewedUUID = data.id;
  document.getElementById("modalAvatar").src = data.avatar_url || "https://i.imgur.com/6VBx3io.png";
  document.getElementById("modalUserId").innerText = data.user_id;
  document.getElementById("modalBio").innerText = data.bio || "No bio yet.";
  const modalBadges = document.getElementById("modalBadges");
  modalBadges.innerHTML = "";
  if (data.badges) {
    data.badges.split(",").forEach(b => {
      const badge = b.trim().toLowerCase();
      modalBadges.innerHTML += `<span class="badge ${badge}">${b.trim()}</span>`;
    });
  }
  await updateFollowBtn();
  document.getElementById("profileModal").style.display = "flex";
}

function closeProfile() {
  document.getElementById("profileModal").style.display = "none";
}

async function updateFollowBtn() {
  const followBtn = document.getElementById("followBtn");
  if (viewedUUID === userUUID) {
    followBtn.style.display = "none";
    return;
  }
  const { data } = await sb
    .from("follows")
    .select("id")
    .eq("follower_id", userUUID)
    .eq("following_id", viewedUUID)
    .maybeSingle();
  followBtn.style.display = "inline-block";
  followBtn.innerText = data ? "Unfollow" : "Follow";
  followBtn.onclick = toggleFollow;
}

async function toggleFollow() {
  const { data } = await sb
    .from("follows")
    .select("id")
    .eq("follower_id", userUUID)
    .eq("following_id", viewedUUID)
    .maybeSingle();
  if (data) {
    await sb.from("follows").delete().eq("id", data.id);
    await sb.rpc("decrement_followers", { uid: viewedUUID });
  } else {
    await sb.from("follows").insert({
      follower_id: userUUID,
      following_id: viewedUUID
    });
    await sb.rpc("increment_followers", { uid: viewedUUID });
    await sb.from("notifications").insert({
      user_id: viewedUUID,
      type: 'follow',
      message: `<strong>${myUserIdText}</strong> started following you`,
      from_user: myUserIdText,
      read: false
    });
  }
  await updateFollowBtn();
  await loadProfile();
  await loadProfilePage();
}

function shareProfile() {
  const profileUrl = `${window.location.origin}${window.location.pathname}?profile=${userUUID}`;
  copyToClipboard(profileUrl);
  showToast('Profile link copied to clipboard!');
}

function shareModalProfile() {
  const profileUrl = `${window.location.origin}${window.location.pathname}?profile=${viewedUUID}`;
  copyToClipboard(profileUrl);
  showToast('Profile link copied to clipboard!');
}

function copyToClipboard(text) {
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text).catch(() => {
      fallbackCopyToClipboard(text);
    });
  } else {
    fallbackCopyToClipboard(text);
  }
}

function fallbackCopyToClipboard(text) {
  const textarea = document.createElement('textarea');
  textarea.value = text;
  textarea.style.position = 'fixed';
  textarea.style.opacity = '0';
  document.body.appendChild(textarea);
  textarea.select();
  document.execCommand('copy');
  document.body.removeChild(textarea);
}

async function loadSharedProfile(profileId) {
  const { data: profile } = await sb
    .from("user_profiles")
    .select("*")
    .eq("id", profileId)
    .single();
  if (!profile) {
    document.body.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100vh; color: var(--text-primary);">Profile not found</div>';
    return;
  }
  document.querySelector('nav').style.display = 'none';
  document.querySelector('.mobile-nav').style.display = 'none';
  document.getElementById('viewProfilePage').classList.add('active');
  const avatarUrl = profile.avatar_url || "https://i.imgur.com/6VBx3io.png";
  document.getElementById("viewProfileAvatar").src = avatarUrl;
  document.getElementById("viewProfileName").innerText = profile.user_id;
  document.getElementById("viewProfileUsername").innerText = "@" + profile.user_id;
  document.getElementById("viewProfileBio").innerText = profile.bio || "No bio yet.";
  document.getElementById("viewFollowersCount").innerText = profile.followers || 0;
  const { data: followingData } = await sb
    .from("follows")
    .select("id")
    .eq("follower_id", profileId);
  document.getElementById("viewFollowingCount").innerText = followingData ? followingData.length : 0;
  const badgesContainer = document.getElementById("viewProfileBadges");
  badgesContainer.innerHTML = "";
  if (profile.badges) {
    profile.badges.split(",").forEach(b => {
      const badge = b.trim().toLowerCase();
      badgesContainer.innerHTML += `<span class="badge ${badge}">${b.trim()}</span>`;
    });
  }
  const { data: posts } = await sb
    .from("posts")
    .select("*")
    .eq("author", profile.user_id)
    .order("created_at", { ascending: false });
  const viewUserPostsContainer = document.getElementById("viewUserPosts");
  if (!posts || posts.length === 0) {
    viewUserPostsContainer.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">No posts yet</div>';
    return;
  }
  posts.forEach(p => {
    let badgesHTML = "";
    if (profile.badges) {
      profile.badges.split(",").forEach(b => {
        const badge = b.trim().toLowerCase();
        badgesHTML += `<span class="badge ${badge}">${b.trim()}</span>`;
      });
    }
    const timeAgo = getTimeAgo(new Date(p.created_at));
    const categoryEmojis = {
      'fun': 'ðŸŽ‰',
      'motivation': 'ðŸ’ª',
      'education': 'ðŸ“š',
      'tech': 'ðŸ’»',
      'nature': 'ðŸŒ¿',
      'space': 'ðŸš€',
      'interesting': 'âœ¨',
      'other': 'ðŸ“'
    };
    const categoryLabel = p.type ? `${categoryEmojis[p.type] || ''} ${p.type}` : '';

    const postElement = document.createElement('div');
    postElement.className = 'post';
    postElement.innerHTML = `
      <div class="post-content-wrapper">
        <img class="post-avatar" src="${avatarUrl}">
        <div class="post-main">
          <div class="post-header">
            <span class="username">${p.author}</span>
            ${badgesHTML}
            <span class="post-time">Â· ${timeAgo}</span>
            ${categoryLabel ? `<span class="post-category">${categoryLabel}</span>` : ''}
          </div>
          <p class="post-text">${p.content || ""}</p>
          ${p.image_url ? `<img class="post-img" src="${p.image_url}">` : ""}
        </div>
      </div>
    `;

    viewUserPostsContainer.appendChild(postElement);
  });
}

async function uploadImage(file) {
  const fd = new FormData();
  fd.append("image", file);
  const r = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
    method: "POST",
    body: fd
  });
  const json = await r.json();
  return json.data.url;
}

function logout() {
  localStorage.removeItem("id");
  if (timerInterval) {
    clearInterval(timerInterval);
  }
  location.href = "log-in.html";
}

function setupEmojiPicker() {
  const emojiBtn = document.getElementById('emojiBtn');
  const emojiPicker = document.getElementById('emojiPicker');
  emojiBtn.addEventListener('click', async (e) => {
    e.stopPropagation();
    const isVisible = emojiPicker.style.display === 'block';
    emojiPicker.style.display = isVisible ? 'none' : 'block';
    if (!emojisLoaded && !isVisible) {
      await loadEmojis();
    }
  });
  document.addEventListener('click', (e) => {
    if (!emojiPicker.contains(e.target) && e.target !== emojiBtn) {
      emojiPicker.style.display = 'none';
    }
  });
}

function setupSearch() {
  const searchInput = document.getElementById('userSearch');
  searchInput.addEventListener('input', debounce(searchUsers, 300));
  searchInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      searchUsers();
    }
  });
}

function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

async function loadEmojis() {
  const emojiGrid = document.getElementById('emojiGrid');
  emojiGrid.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">Loading emojis...</div>';
  try {
    const categories = [
      'face-positive',
      'face-negative',
      'face-neutral',
      'hand-prop',
      'person-gesture'
    ];
    const allEmojiPromises = categories.map(category =>
      fetch(`https://emojihub.yurace.pro/api/all/group/${category}`)
        .then(res => res.ok ? res.json() : [])
        .catch(() => [])
    );

    const results = await Promise.all(allEmojiPromises);
    allEmojis = results.flat();

    if (allEmojis.length === 0) {
      throw new Error("No emojis loaded");
    }

    emojiGrid.innerHTML = '';

    allEmojis.forEach(emoji => {
      const charCode = emoji.htmlCode[0];
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = charCode;
      const emojiCharacter = tempDiv.textContent;

      const button = document.createElement('button');
      button.className = 'emoji-btn-item';
      button.innerHTML = emojiCharacter;
      button.title = emoji.name || '';

      button.addEventListener('click', (e) => {
        e.stopPropagation();
        insertEmoji(emojiCharacter);
      });

      emojiGrid.appendChild(button);
    });

    emojisLoaded = true;
  } catch (error) {
    console.error('Could not fetch emojis:', error);
    emojiGrid.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">Failed to load emojis ðŸ˜ž</div>';
  }
}

function insertEmoji(emoji) {
  const postContent = document.getElementById('postContent');
  const start = postContent.selectionStart;
  const end = postContent.selectionEnd;
  const newText = postContent.value.substring(0, start) + emoji + postContent.value.substring(end);
  postContent.value = newText;
  postContent.selectionStart = postContent.selectionEnd = start + emoji.length;
  postContent.focus();
  
  const event = new Event('input');
  postContent.dispatchEvent(event);
}

function emailSupport() {
  window.location.href = 'mailto:tarchtechnologies@gmail.com';
}

async function populateDevices() {
  const devicesList = document.getElementById('devicesList');
  const deviceInfo = getDeviceInfo();
  const ip = await getIPAddress();
  const location = await getLocation(ip);

  const currentDevice = document.createElement('div');
  currentDevice.className = 'settings-item no-hover';
  currentDevice.innerHTML = `
    <div class="settings-item-left">
      <span class="material-icons">${deviceInfo.deviceIcon}</span>
      <div class="item-text">
        <h4>${deviceInfo.osName} Â· ${deviceInfo.browserName}</h4>
        <p>IP: ${ip} Â· ${location} (Current Device)</p>
      </div>
    </div>
    <span class="status-indicator online"></span>
  `;
  devicesList.appendChild(currentDevice);
}

function getDeviceInfo() {
  const ua = navigator.userAgent;
  let deviceType = 'desktop';
  let deviceIcon = 'computer';
  let osName = 'Unknown OS';
  let browserName = 'Unknown Browser';

  if (ua.indexOf('Win') !== -1) osName = 'Windows';
  else if (ua.indexOf('Mac') !== -1) osName = 'macOS';
  else if (ua.indexOf('Linux') !== -1) osName = 'Linux';
  else if (ua.indexOf('Android') !== -1) {
    osName = 'Android';
    deviceType = 'mobile';
    deviceIcon = 'smartphone';
  }
  else if (ua.indexOf('iOS') !== -1 || ua.indexOf('iPhone') !== -1 || ua.indexOf('iPad') !== -1) {
    osName = ua.indexOf('iPad') !== -1 ? 'iPad' : 'iPhone';
    deviceType = 'mobile';
    deviceIcon = 'smartphone';
  }

  if (ua.indexOf('Chrome') !== -1 && ua.indexOf('Edg') === -1) browserName = 'Chrome';
  else if (ua.indexOf('Safari') !== -1 && ua.indexOf('Chrome') === -1) browserName = 'Safari';
  else if (ua.indexOf('Firefox') !== -1) browserName = 'Firefox';
  else if (ua.indexOf('Edg') !== -1) browserName = 'Edge';
  else if (ua.indexOf('Opera') !== -1 || ua.indexOf('OPR') !== -1) browserName = 'Opera';

  return {
    deviceType,
    deviceIcon,
    osName,
    browserName
  };
}

async function getIPAddress() {
  try {
    const response = await fetch('https://api.ipify.org?format=json');
    const data = await response.json();
    return data.ip;
  } catch (error) {
    return 'Unable to detect';
  }
}

async function getLocation(ip) {
  try {
    const response = await fetch(`https://ipapi.co/${ip}/json/`);
    const data = await response.json();
    return `${data.city}, ${data.country_name}`;
  } catch (error) {
    return 'Location unavailable';
  }
}

populateDevices();

document.addEventListener('contextmenu', function (e) {
  e.preventDefault();
});

document.addEventListener('keydown', function (e) {
  if (
    e.key === 'F12' ||
    (e.ctrlKey && e.shiftKey && ['I', 'C', 'J'].includes(e.key)) ||
    (e.ctrlKey && e.key === 'U')
  ) {
    e.preventDefault();
  }
});
</script>
</body>
</html>